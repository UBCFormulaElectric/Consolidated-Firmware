# Import include directories and source files for Cortex M4 profiler
add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/profiler-cortex-m4)
list(APPEND SHARED_IO_INCLUDE_DIRS ${PROFILER_INCLUDE_DIRS})
file(GLOB_RECURSE PROFILER_SRCS ${PROFILER_BASE_DIR}/*.c)
list(APPEND SHARED_IO_SRCS ${PROFILER_SRCS})

# Import include directories and source files for SEGGER SystemView.
set(SEGGER_SYSTEMVIEW_INCLUDE_DIRS
    "${CMAKE_CURRENT_SOURCE_DIR}/SEGGER_SystemView_Src/SEGGER"
    "${CMAKE_CURRENT_SOURCE_DIR}/SEGGER_SystemView_Src/Config"
    "${CMAKE_CURRENT_SOURCE_DIR}/SEGGER_SystemView_Src/Sample/FreeRTOSV10"
)
list(APPEND SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_INCLUDE_DIRS ${SEGGER_SYSTEMVIEW_INCLUDE_DIRS})
file(GLOB SEGGER_SYSTEMVIEW_SRCS 
    "SEGGER_SystemView_Src/SEGGER/*.c" 
    "SEGGER_SystemView_Src/SEGGER/*.S"
)
# We use ARM's embedded GCC compiler, so append the GCC-specific SysCalls.
list(APPEND SEGGER_SYSTEMVIEW_SRCS "${CMAKE_CURRENT_SOURCE_DIR}/SEGGER_SystemView_Src/SEGGER/Syscalls/SEGGER_RTT_Syscalls_GCC.c")
# Append the FreeRTOS patch to get SystemView to work with FreeRTOS. All of our STM32F412x boards use FreeRTOS V10. 
# Note that the GSM currently has an STM32F302x MCU, which is limited to FreeRTOS V9, so SystemView is not supported
# on the GSM.
file(GLOB_RECURSE SEGGER_SYSTEMVIEW_FREERTOS_SRCS "SEGGER_SystemView_Src/Sample/FreeRTOSV10/*.c")
list(APPEND SEGGER_SYSTEMVIEW_SRCS ${SEGGER_SYSTEMVIEW_FREERTOS_SRCS})
list(APPEND SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_SRCS ${SEGGER_SYSTEMVIEW_SRCS})

# Import include directory for fff.h
list(APPEND SHARED_GOOGLETEST_TEST_THIRD_PARTY_INCLUDE_DIRS ${CMAKE_CURRENT_SOURCE_DIR}/fff)

# Import source files for Newlib-FreeRTOS patch
file(GLOB_RECURSE NEWLIB_FREERTOS_PATCH_SRCS ${CMAKE_CURRENT_SOURCE_DIR}/newlib_freertos_patch/*.c)
list(APPEND SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_SRCS ${NEWLIB_FREERTOS_PATCH_SRCS})

# Import sources files for SBG Systems library
set(SBG_ECOM_DIR ${CMAKE_CURRENT_SOURCE_DIR}/sbgECom)
list(APPEND SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_INCLUDE_DIRS ${SBG_ECOM_DIR}/common ${SBG_ECOM_DIR}/src)
file(GLOB_RECURSE SBG_ECOM_SRCS
    ${SBG_ECOM_DIR}/src/*.c
    ${SBG_ECOM_DIR}/common/crc/*.c
    ${SBG_ECOM_DIR}/common/platform/*.c
    ${SBG_ECOM_DIR}/common/interfaces/sbgInterface.c
)
list(APPEND SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_SRCS ${SBG_ECOM_SRCS})

# Import littlefs
CPMAddPackage(
  NAME LITTLEFS
  GITHUB_REPOSITORY littlefs-project/littlefs
  GIT_TAG v2.8.0
)
# Import sources files for littlefs
list(APPEND SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_INCLUDE_DIRS ${LITTLEFS_SOURCE_DIR})
file(GLOB_RECURSE LITTLEFS_SRC "${LITTLEFS_SOURCE_DIR}/lfs.c" "${LITTLEFS_SOURCE_DIR}/lfs_util.c" )
list(APPEND SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_SRCS ${LITTLEFS_SRC})

# Expose the following variables to the parent scope (i.e. The scope of any
# other CMakeLists.txt that uses add_subdirectory() on this CMakeLists.txt).
set(SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_SRCS
    ${SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_SRCS}
    PARENT_SCOPE)
set(SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_INCLUDE_DIRS
    ${SHARED_ARM_BINARY_X86_INCOMPATIBLE_THIRD_PARTY_INCLUDE_DIRS}
    PARENT_SCOPE)
set(SHARED_GOOGLETEST_TEST_THIRD_PARTY_INCLUDE_DIRS
    ${SHARED_GOOGLETEST_TEST_THIRD_PARTY_INCLUDE_DIRS}
    PARENT_SCOPE)
