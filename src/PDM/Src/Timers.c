/******************************************************************************
 * Includes
 ******************************************************************************/
#include "Timers.h"
#include "SharedWatchdog.h"
#include "CurrentSense.h"
#include "VoltageSense.h"

/******************************************************************************
 * Module Preprocessor Constants
 ******************************************************************************/
// clang-format off

/******************************************************************************
 * Module Preprocessor Macros
 ******************************************************************************/

/******************************************************************************
 * Module Typedefs
 ******************************************************************************/
// clang-format on

/******************************************************************************
 * Module Variable Definitions
 ******************************************************************************/

/******************************************************************************
 * Private Function Prototypes
 ******************************************************************************/

/******************************************************************************
 * Private Function Definitions
 ******************************************************************************/

/******************************************************************************
 * Function Definitions
 ******************************************************************************/
void Timers_Init(void)
{
    HAL_TIM_Base_Start_IT(&ADC_DMA_TIMER);
    HAL_TIM_Base_Start_IT(&CONTROL_LOOP_TIMER);
}

void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)
{
    if (htim == &CONTROL_LOOP_TIMER)
    {        
        CurrentSense_TransmitCurrent();
        // TODO: uncomment this once current sense is fixed
        //VoltageSense_TransmitVoltage();

        SharedWatchdog_RefreshIwdg();
    }
}
