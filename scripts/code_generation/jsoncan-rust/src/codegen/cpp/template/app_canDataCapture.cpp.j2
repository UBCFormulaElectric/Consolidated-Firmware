/**
 * @note This file is auto-generated. Do not modify!
 */
// clang-format off


/* ------------------------------- Includes ------------------------------- */

#include "app_canDataCapture.hpp"
#include "app_canUtils.hpp"

namespace app::can_data_capture {
/* -------------------------------- Macros -------------------------------- */


{%- for msg in messages %}
{%- if msg.log_cycle_time.is_some() && msg.log_cycle_time != msg.cycle_time %}
#define {{ msg.name }}_LOG_CYCLE_TIME ({{ msg.log_cycle_time.unwrap() }})
{%- endif %}
{%- endfor %}

{%- for msg in messages %}
{%- if msg.telem_cycle_time.is_some() && msg.telem_cycle_time != msg.cycle_time %}
#define {{msg.name}}_TELEM_CYCLE_TIME ({{msg.telem_cycle_time.unwrap()}})
{%- endif %}
{%- endfor %}

/* -------------------------- Private Variables --------------------------- */

{%- for msg in messages %}
{%- if msg.log_cycle_time.is_some() && msg.log_cycle_time != msg.cycle_time %}
static uint32_t {{msg.name}}_next_log_time_ms;
{%- endif %}
{%- endfor %}

{%- for msg in messages %}
{%- if msg.telem_cycle_time.is_some() && msg.telem_cycle_time != msg.cycle_time %}
static uint32_t {{msg.name}}_next_telem_time_ms;
{%- endif %}
{%- endfor %}
/* ------------------------- Function Definitions ------------------------- */


void init()
{
    // Reset next log capture times.
    {%- for msg in messages %}
    {%- if msg.log_cycle_time.is_some() && msg.log_cycle_time != msg.cycle_time %}
    {{msg.name}}_next_log_time_ms = 0U;
    {%- endif %}
    {%- endfor %}
    
    // Reset next telem capture times.
    {%- for msg in messages %}
    {%- if msg.telem_cycle_time.is_some() && msg.telem_cycle_time != msg.cycle_time %}
    {{msg.name}}_next_telem_time_ms = 0U;
    {%- endif %}
    {%- endfor %}
}

bool needsLog(uint32_t msg_id, uint32_t time_ms)
{
    (void)time_ms; // could be unused
    switch (msg_id)
    {
        {%- for msg in messages %}
        {%- if msg.log_cycle_time.is_some() %}
        case {{msg.id_macro()}}:
        {
        {%- if msg.log_cycle_time != msg.cycle_time %}
            if (time_ms > {{msg.name}}_next_log_time_ms) {{msg.name}}_next_log_time_ms = time_ms + {{msg.name}}_LOG_CYCLE_TIME;
            return time_ms > {{msg.name}}_next_log_time_ms;
        {%- else %}
            return true;
        {%- endif %}
        }
        {%- endif %}
        {%- endfor %}
        default:
            break;
    }
    return false;
}

bool needsTelem(uint32_t msg_id, uint32_t time_ms)
{
    (void)time_ms; // could be unused
    switch (msg_id)
    {
        {%- for msg in messages %}
        {%- if msg.telem_cycle_time.is_some() %}
        case {{msg.id_macro()}}:
        {
        {%- if msg.telem_cycle_time != msg.cycle_time %}
            if (time_ms > {{msg.name}}_next_log_time_ms)
            {
                // Capture msg && increment variable.
                {{msg.name}}_next_log_time_ms = time_ms + {{msg.name}}_TELEM_CYCLE_TIME;
                return true;
            }
            else
            {
                // Not ready to capture yet.
                return false;
            }
        {%- else %}
            return true;
        {%- endif %}
        }
        {%- endif %}
        {%- endfor %}
        default:
            break;
    }
    return false;
}
}