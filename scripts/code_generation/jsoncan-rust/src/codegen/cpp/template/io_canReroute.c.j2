/**
 * @note This file is auto-generated. Do not modify!
 */
// clang-format off

/* ------------------------------- Includes ------------------------------- */
#include "io_canReroute.h"

{# 
    1. init transmit functions
    2. generate switch case to check if the message needs to be rerouted
    3. generate the reroute function arg is the message, use transmit function to send the message
        3.1 need all message need reroute to be defined in the io_canTx.h
        3.2 need bus of the message need to be resent
    4. expose the 2. function only 

    To use this module, but call init with all the transmit functions 
        the transmit function can be push stuff to the queue or send the message directly
    Call 2. function in the canRx callback
 #}

{%- for bus in node_busses %}
static void (*transmit_func_{{bus.name}})(const JsonCanMsg* tx_msg);
{%- endfor %}


void io_canReroute_init( 
{%- for bus in node_busses %}
    void (*transmit_func_{{bus.name}}_in)(const JsonCanMsg*) {%- if !loop.last -%}, {%- endif %}
{%- endfor %}
)
{
    {%- for bus in node_busses %}
    transmit_func_{{bus.name}} = transmit_func_{{bus.name}}_in;
    {%- endfor %}
}

{% for from_bus in node_busses %}
void io_canReroute_{{from_bus.name}}(const JsonCanMsg* rx_msg)
{
    switch(rx_msg->std_id)
    {
        {%- for (msg_id, busses) in reroutes.get_forwards_for_bus(from_bus.name) %}
        case {{ id_macro(msg_id) }}:
        {
            {%- for bus_name in busses %}
            transmit_func_{{bus_name}}(rx_msg);
            {%- endfor %}
            break;
        }
        {%- endfor %}
        default:
            break;
    }
}
{%- endfor %}