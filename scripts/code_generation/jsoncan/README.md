# jsoncan

jsoncan is a project to generate embedded CAN drivers and a CAN DBC file from JSON data. To modify the CAN bus, developers will only need to modify the JSON data, and the CAN drivers and DBC will be auto-generated upon building. 

This will replace the old system where CAN drivers were auto-generated from a developer-edited DBC file. 

Confluence page: https://ubcformulaelectric.atlassian.net/wiki/spaces/UFE/pages/39485630/Generating+CAN+from+JSON+data+JSON2CAN

## Schema Documentation

For documentation the JSON schema, read the `docs` folder.

## Code Overview

The main entry point is `generate_can_from_json.py`, and the paths to input JSON data and output autogenerated code are provided as arguments. Use `run_example.sh` to run with the example JSON data. 

`generate_can_from_json.py` does the following: 

1. Parses the JSON data, see `src/json_parsing/json_can_parsing.py`. There is some JSON schema validation (see `src/json_parsing/schema_validation.py`) and error checking.
2. `json_can_parsing.py` generates a `CanDatabase` object. This is a language-independent description of a CAN bus (nodes, messages, and signals). 
3. Generate a DBC file from the CAN database (`src/dbc_generation`).
4. Generate embedded C files (all C generation Python lives in `src/codegen/c_generation`).

The generated C files are: 

1. `io_canTx.h/c`: Functions for sending messages, at certain cycle times and asynchronously. Pulls the signal values to send from the CAN TX table in `app_canTx.h/c`. 
2. `app_canTx.h/c`: Holds the CAN TX table, a big struct to hold the current data that is to be transmitted on the bus.
3. `io_canRx.h/c`: Functions for receiving messages. One for filtering a message by ID (i.e. deciding if this node should respond) and another for unpacking a received message into the CAN RX table.
4. `app_canRx.h/c`: Holds the CAN RX table, a big struct to hold the current data that was received from the bus. 

## Examples

To see the example's JSON schema, see example JSON CAN data in `example_json/`. 

The resulting generated embedded .h/.c lives in `example_generated/App/` and `example_generated/Io/`. The generated DBC lives in `example_generated/Dbc/`.

Use `run_example.sh` to generate from the examples in `example_json/` to code in `example_generated/`.
